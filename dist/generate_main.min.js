"use strict";const API_URL={ELEMENT_CONFIG:"http://dev.omipage.com/api/v1/landings/",COLLECTION_PRODUCTS:"http://dev.omipage.com/api/v1/products/simple/"},API_LIST_PAGE_SIZE=10,EnumLandingBlockElementName={NONE:"",LANDING_HEADER:"OMP_HEADER",LANDING_MENU_FOOTER:"OMP_MENU_FOOTER",LANDING_PRODUCT_DETAIL:"OMP_PRODUCT_DETAIL",LANDING_ALL_PRODUCTS:"OMP_ALL_PRODUCTS",DESIGN_CAROUSEL:"OMP_CAROUSEL",DESIGN_TWO_IMAGE:"OMP_TWO_IMAGE",DESIGN_VIDEO:"OMP_VIDEO",DESIGN_OUTSTANDING_PRODUCT:"OMP_OUTSTANDING_PRODUCT",DESIGN_BEST_SELLING_PRODUCT:"OMP_BEST_SELLING_PRODUCT",DESIGN_NEW_PRODUCT:"OMP_NEW_PRODUCT",DESIGN_RELATED_PRODUCT:"OMP_RELATED_PRODUCT",DESIGN_FLASH_SALE:"OMP_FLASH_SALE"},EnumPageType={HOME:"home",PRODUCT_DETAIL:"product_detail",POLICY:"policy_page"};!function(n){class e{constructor(){}_addScrollEvent=(n,e)=>{let t=0;n.addEventListener("scroll",(n=>{n.target.scrollTop+n.target.clientHeight>n.target.scrollHeight-5&&n.target.scrollTop>t&&e(!0),t=n.target.scrollTop}))}}class t{landing_token;constructor(){this._getLandingToken()}_createGetRequest=n=>new Promise(((e,t)=>{const i=new XMLHttpRequest;i.onreadystatechange=()=>{if(4===i.readyState&&200===i.status)return e(i.responseText)},i.open("GET",n,!0),i.setRequestHeader("Authorization",this.landing_token),i.send()}));getPageElementsConfigAsync=async n=>{const e=`${API_URL.ELEMENT_CONFIG}${n}/elements/`;return await this._createGetRequest(e)};getCollectionDataAsync=async n=>{const e=`${API_URL.COLLECTION_PRODUCTS}?collection_id=${n}&is_parent=true`;return await this._createGetRequest(e)};getLandingProductAsync=async n=>{const e=`${API_URL.COLLECTION_PRODUCTS}?page=${n}&page_size=10&is_parent=true`;return await this._createGetRequest(e)};_getLandingToken=()=>{const n=document.querySelectorAll('meta[name="omp-key"]')[0];this.landing_token=`Landing ${n.getAttribute("content")}`}}class i{landing_domain=document.location.origin;loading_element=null;constructor(){this.loading_element=document.getElementsByClassName("omp-loading")[0]}_showLoading=()=>{this.loading_element.classList.contains("show")||this.loading_element.classList.add("show")};_hideLoading=()=>{this.loading_element.classList.contains("show")&&this.loading_element.classList.remove("show")};_queryElementsByClass=(n,e)=>n.querySelectorAll(`div[class=${e}]`)[0];_queryElementsById=(n,e)=>n.getElementById(`${e}`);_queryElementsLikeClassName=(n,e)=>n.querySelectorAll(`div[class^=${e}]`);_headerElementBuilder=(n,e)=>`<div  id="OMP_HEADER">\n                        <div  class="omp-header-block--content">\n                            <img  alt="Landing Logo" src="${e}">\n                            <div  class="omp-header--landing-name">${n}</div>\n                            <div  class="omp-header--space"></div>\n                        </div>\n                    </div>`;_footerElementBuilder=()=>'<div  id="OMP_MENU_FOOTER">\n                        <div  class="omp-header-block--content">\n                            <div  class="omp-menu-wrapper">\n                                <div  class="omp-menu-item ng-star-inserted">\n                                    <div  class="omp-menu-item--content active">\n                                        <p>\n                                            <i class="bi bi-house"></i>\n                                        </p>\n                                        <span>Trang chủ</span>\n                                    </div>\n                                </div>\n                                <div  class="omp-menu-item ng-star-inserted">\n                                    <div class="omp-menu-item--content">\n                                        <p>\n                                            <i class="bi bi-cart4"></i>\n                                        </p>\n                                        <span>Giỏ hàng</span>\n                                    </div>\n                                </div>\n                                <div  class="omp-menu-item ng-star-inserted">\n                                    <div  class="omp-menu-item--content">\n                                        <p>\n                                            <i class="bi bi-heart"></i>\n                                        </p>\n                                        <span>Yêu thích</span>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>';_renderListProduct=n=>{let e="";return n.forEach((n=>{e+=`<div class="omp-col-6 omp-product-wrapper">\n                                <a class="omp-product-card" href="${this.landing_domain}${n.link}">\n                                    <div class="omp-product-card__top">\n                                        <span class="product-card--premium">Hot</span>\n                                        <img alt="" class="mb-2" src="${n.avatar_image}">\n                                    </div>\n                                    <div class="omp-product-card__bottom">\n                                        <div class="omp-product-card--name">${n.name}</div>\n                                        <div class="omp-product-card--category">${n.sku}</div>\n                                        <div class="product--rating-stars">\n                                            <i class="bi bi-star-fill"></i>\n                                            <i class="bi bi-star-fill"></i>\n                                            <i class="bi bi-star-fill"></i>\n                                            <i class="bi bi-star-fill"></i>\n                                            <i class="bi bi-star-fill"></i>\n                                        </div>\n                                        <div class="omp-product-card--price">\n                                            <span class="mr-1">${n.listed_price} ${n.currency}</span>\n                                            <small>\n                                                <del>${n.price} ${n.currency}</del>\n                                            </small>\n                                        </div>\n                                    </div>\n                                </a>\n                            </div>`})),e};_allProductContentBuilder=n=>{if(!n.length)return"";return`<div class="omp-landing-block--title">TẤT CẢ SẢN PHẨM</div>\n                    <div class="omp-landing-block--content">\n                        <div class="omp-wp__all-products">\n                            <div class="omp-row">${this._renderListProduct(n)}</div>\n                        </div>\n                    </div>`};_outstandingProductContentBuilder=(n,e)=>{if(!e.length)return"";return`<div class="omp-landing-block--title">${n}</div>\n                    <div class="omp-landing-block--content">\n                        <div class="omp-wp__outstanding-product">\n                            <div class="omp-row">${this._renderListProduct(e)}</div>\n                        </div>\n                    </div>`};_bestSellingProductContentBuilder=(n,e)=>{if(!e.length)return"";let t="";return e.forEach((n=>{t+=""})),`<div class="omp-landing-block--title">${n}</div>\n                    <div class="omp-landing-block--content">\n                        <div class="omp-wp__outstanding-product">\n                            <div class="omp-row">${t}</div>\n                        </div>\n                    </div>`};_newProductContentBuilder=(n,e)=>{if(!e.length)return"";let t="";return e.forEach((n=>{t+=""})),`<div class="omp-landing-block--title">${n}</div>\n                    <div class="omp-landing-block--content">\n                        <div class="omp-wp__outstanding-product">\n                            <div class="omp-row">${t}</div>\n                        </div>\n                    </div>`};_flashSaleProductContentBuilder=(n,e)=>{if(!e.length)return"";let t="";return e.forEach((n=>{t+=""})),`<div class="omp-landing-block--title">${n}</div>\n                    <div class="omp-landing-block--content">\n                        <div class="omp-wp__outstanding-product">\n                            <div class="omp-row">${t}</div>\n                        </div>\n                    </div>`};_bannerImageProductContentBuilder=(n,e)=>{if(!e.length)return"";return`<div class="omp-landing-block--title">${n}</div>\n                    <div class="omp-landing-block--content">\n                        <div class="omp-wp__outstanding-product">\n                            <div class="omp-row"></div>\n                        </div>\n                    </div>`};_bannerTwoImageProductContentBuilder=(n,e)=>{if(!e.length)return"";return`<div class="omp-landing-block--title">${n}</div>\n                    <div class="omp-landing-block--content">\n                        <div class="omp-wp__outstanding-product">\n                            <div class="omp-row"></div>\n                        </div>\n                    </div>`};_bannerVideoProductContentBuilder=(n,e)=>{if(!e.length)return"";return`<div class="omp-landing-block--title">${n}</div>\n                    <div class="omp-landing-block--content">\n                        <div class="omp-wp__outstanding-product">\n                            <div class="omp-row"></div>\n                        </div>\n                    </div>`}}n.LandingElementConfig=class{total_product_in_landing=0;all_product_current_page=1;data_service=new t;content_builder=new i;global_event=new e;constructor(){}initialMainPage=()=>{this._getElementConfigs().then()};_renderAllProductBlock=async n=>{const e=await this.data_service.getLandingProductAsync(n),t=JSON.parse(e);this.total_product_in_landing=t.count;const i=t.results;if(i&&i.length){this.all_product_current_page++;this.content_builder._queryElementsById(document,EnumLandingBlockElementName.LANDING_ALL_PRODUCTS).innerHTML=this.content_builder._allProductContentBuilder(i)}};_renderMoreProductOfLanding=async n=>{const e=await this.data_service.getLandingProductAsync(n),t=JSON.parse(e).results;if(t&&t.length){this.all_product_current_page++;const n=this.content_builder._queryElementsById(document,EnumLandingBlockElementName.LANDING_ALL_PRODUCTS);this.content_builder._queryElementsByClass(n,"omp-row").innerHTML+=this.content_builder._renderListProduct(t)}return new Promise(((n,e)=>n(!0)))};_handleGetPageElementConfig=n=>{if(!n||!n.elements||!n.elements.length)return;const e=n.elements.find((n=>n.page_id===EnumPageType.HOME));e&&e.page_elements&&this._renderElement(e.page_elements)};_renderElement=n=>{const e=n.dynamic_elements;n.statics_elements.forEach((n=>{switch(n.element_id){case EnumLandingBlockElementName.LANDING_HEADER:document.getElementById(n.element_id).innerHTML=this.content_builder._headerElementBuilder("My Shop","https://storage.googleapis.com/omisell-cloud/omipage/logoulashop.png");break;case EnumLandingBlockElementName.LANDING_MENU_FOOTER:document.getElementById(n.element_id).innerHTML=this.content_builder._footerElementBuilder()}})),e.forEach(((n,t)=>{const i=t===e.length-1;this._renderProductElement(n,i).then()}))};_renderProductElement=async(n,e)=>{const t=document.getElementById(n.element_id);if(n.config&&n.config.collection){const e=await this.data_service.getCollectionDataAsync(n.config.collection.id),i=JSON.parse(e).results;switch(n.element_name){case EnumLandingBlockElementName.DESIGN_OUTSTANDING_PRODUCT:t.innerHTML=this.content_builder._outstandingProductContentBuilder(n.element_title,i)}}e&&this._renderAllProductBlock(this.all_product_current_page).then()};_getElementConfigs=async()=>{this.content_builder._showLoading();const n=await this.data_service.getPageElementsConfigAsync(35),e=JSON.parse(n);await this._handleGetPageElementConfig(e),this.content_builder._hideLoading();this.global_event._addScrollEvent(this.content_builder._queryElementsById(document,"omp_wrapper"),(async()=>{10*this.all_product_current_page>this.total_product_in_landing||(this.content_builder._showLoading(),await this._renderMoreProductOfLanding(this.all_product_current_page),this.content_builder._hideLoading())}))}}}(window);const landing_element_config=new LandingElementConfig;landing_element_config.initialMainPage();
