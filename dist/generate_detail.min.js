"use strict";const API_URL={PRODUCT_DETAIL:"http://dev.omipage.com/api/v1/products/"},EnumLandingBlockElementName={LANDING_PRODUCT_DETAIL:"OMP_PRODUCT_DETAIL"},OMPElementAttributeName="data-omp-element",EnumPDElementAttributeValue={PRODUCT_IMAGE:"product-image",PRODUCT_NAME:"product-name",PRODUCT_LISTED_PRICE:"product-listed-price",PRODUCT_PRICE:"product-price",PRODUCT_SELECT_VARIANT:"variant-select",PRODUCT_QUANTITY:"select-quantity",PRODUCT_DESCRIPTION:"product-description"};!function(t){class e{landing_token;constructor(){this._getLandingToken()}_createGetRequest=t=>new Promise(((e,a)=>{const i=new XMLHttpRequest;i.onreadystatechange=()=>{if(4===i.readyState&&200===i.status)return e(i.responseText)},i.open("GET",t,!0),i.setRequestHeader("Authorization",this.landing_token),i.send()}));getProductDetailById=async t=>{const e=`${API_URL.PRODUCT_DETAIL}${t}/`;return await this._createGetRequest(e)};_getLandingToken=()=>{const t=document.querySelectorAll('meta[name="omp-key"]')[0];this.landing_token=`Landing ${t.getAttribute("content")}`}}class a{loading_element=null;constructor(){this.loading_element=document.getElementsByClassName("omp-loading")[0]}_showLoading=()=>{this.loading_element.classList.contains("show")||this.loading_element.classList.add("show")};_hideLoading=()=>{this.loading_element.classList.contains("show")&&this.loading_element.classList.remove("show")};_queryElementsByAttribute=(t,e,a)=>t.querySelectorAll(`div[${e}=${a}]`)[0];_queryElementsByClass=(t,e)=>t.querySelectorAll(`div[class=${e}]`)[0];_queryElementsLikeClassName=(t,e)=>t.querySelectorAll(`div[class^=${e}]`);_productSelectProductBuilder=t=>{if(!t||!t.length)return"";let e="";return t.forEach((t=>{let a="";t.values&&t.values.length&&t.values.forEach((t=>{a+=`<div class="p-variant-item" data-variant-value="${t.id}">\n                                        ${t.name}\n                                    </div>`})),e+=`<div class="omp-container">\n                                           <p class="omp-mb-0">${t.name}</p>\n                                           <div class="product-variant" data-variant="${t.id}">\n                                                ${a}\n                                           </div>\n                                       </div>`})),`<div class="product-detail--select-product">\n                        ${e}\n                    </div>`}}class i{element_content_builder=new a;product_detail=null;store_group_selected_id=[];store_variant_group=[];constructor(t){this.product_detail=t}_queryProductVariantGroupElements=()=>this.element_content_builder._queryElementsByClass(document,"product-variant");_queryProductVariantOptionElements=t=>this.element_content_builder._queryElementsLikeClassName(t,"p-variant-item");_verifyIncludesArr=(t,e)=>!!(t&&t.length&&e&&e.length)&&e.reduce(((e,a)=>e&&t.includes(a)),!0);_findSelectedVariant=()=>{let t=null;const e=this.store_variant_group.reduce(((t,e)=>t.push(`${e.variant_group_id}-${e.variant_value_selected}`)),[]);return this.product_detail.variants.forEach((a=>{a.variant_attributes_id&&this._verifyIncludesArr(a.variant_attributes_id,e)&&(t=a)})),t};_findVariantOutOfStock=(t,e)=>{const a=[],i=[];return t.forEach((t=>i.push(`${t.variant_group_id}-${t.variant_value_selected}`))),this.product_detail.variants.forEach((t=>{if(t.fulfillable)return;let n=!1;t.variant_attributes_id&&(n=this._verifyIncludesArr(t.variant_attributes_id,i)),n&&a.push(t.attributes.find((t=>t.id===e.variant_group_id))?.value?.id)})),a};handleSelectEvent=()=>{this._queryProductVariantGroupElements().forEach((t=>{const e=parseInt(t.getAttribute("data-variant"));this._addSelectVariantEvent(t,e),this.store_variant_group.push({group_element:t,variant_group_id:e,variant_value_selected:null,has_child_disabled:!1})}))};_addDisabledClassForVariantOption=(t,e)=>{const a=this._findVariantOutOfStock(t,e);if(!a.length)return;const i=this._queryProductVariantOptionElements(e.group_element);this.store_variant_group.forEach((t=>{t.variant_group_id===e.variant_group_id&&(t.has_child_disabled=!0)}));Array.from(i).filter((t=>a.includes(parseInt(t.getAttribute("data-variant-value"))))).forEach((t=>t.classList.add("disabled")))};_updateProductInfoFollowVariantSelected=t=>{if(!t)return;this.element_content_builder._queryElementsByAttribute(document,"data-omp-element",EnumPDElementAttributeValue.PRODUCT_IMAGE).innerHTML=`<img src="${t.images[0]}" alt="ProductImage">`;this.element_content_builder._queryElementsByAttribute(document,"data-omp-element",EnumPDElementAttributeValue.PRODUCT_NAME).innerHTML=`${t.full_name}`;this.element_content_builder._queryElementsByAttribute(document,"data-omp-element",EnumPDElementAttributeValue.PRODUCT_PRICE).innerHTML=`${t.price}`;this.element_content_builder._queryElementsByAttribute(document,"data-omp-element",EnumPDElementAttributeValue.PRODUCT_LISTED_PRICE).innerHTML=`${t.listed_price}`;this.element_content_builder._queryElementsByAttribute(document,"data-omp-element",EnumPDElementAttributeValue.PRODUCT_DESCRIPTION).innerHTML=`${t.description}`};_updateDisableSelectStatus=()=>{let t,e=[];this.store_variant_group.forEach((a=>{null!==a.variant_value_selected?e.push(a):t=a})),e.length===this.store_variant_group.length-1&&this._addDisabledClassForVariantOption(e,t),e.length===this.store_variant_group.length&&(this.store_variant_group.forEach((t=>{e=this.store_variant_group.filter((e=>e.variant_group_id!==t.variant_group_id)),this._addDisabledClassForVariantOption(e,t)})),this._updateProductInfoFollowVariantSelected(this._findSelectedVariant()))};_removeElementClass=(t,e)=>{t&&t.length&&t.forEach((t=>{t.classList.contains(e)&&t.classList.remove(e)}))};_updateVariantSelectedValue=(t,e)=>{if(this.store_variant_group.forEach((a=>{a.variant_group_id===t&&(a.variant_value_selected=e)})),e&&!this.store_group_selected_id.includes(t)&&this.store_group_selected_id.push(t),e||(this.store_group_selected_id=this.store_group_selected_id.filter((e=>e!==t))),this.store_group_selected_id.length>=this.store_variant_group.length-1){const t=this.store_variant_group.find((t=>null===t.variant_value_selected))?.group_element,e=this.store_variant_group.filter((t=>!0===t.has_child_disabled));e.length?e.forEach((t=>{this._removeElementClass(Array.from(this._queryProductVariantOptionElements(t.group_element)),"disabled")})):this._removeElementClass(Array.from(this._queryProductVariantOptionElements(t)),"disabled")}};_addSelectVariantEvent=(t,e)=>{const a=this._queryProductVariantOptionElements(t),i=t=>{if(!t||!t.target)return;const i=t.target;if(i.classList.contains("disabled"))return;let n=null;i.classList.contains("active")?i.classList.remove("active"):(n=parseInt(t.target.getAttribute("data-variant-value")),this._removeElementClass(Array.from(a),"active"),i.classList.add("active")),this._updateVariantSelectedValue(e,n),this._updateDisableSelectStatus()};a.forEach((t=>{t.addEventListener("click",i)}))}}t.ProductDetail=class{data_service=new e;content_builder=new a;select_variant_button=null;constructor(){}initPage=()=>{const e=t.location.href.split("."),a=e[e.length-1];this._getProductDetailById(a).then()};_getProductDetailById=async t=>{const e=await this.data_service.getProductDetailById(t),a=this._addVariantAttributesId(JSON.parse(e));this.content_builder._queryElementsByAttribute(document,"data-omp-element",EnumPDElementAttributeValue.PRODUCT_SELECT_VARIANT).innerHTML=this.content_builder._productSelectProductBuilder(a.options),this.select_variant_button=new i(a),this.select_variant_button.handleSelectEvent()};_addVariantAttributesId=t=>t&&t.variants&&t.variants.length?(t.variants.forEach((t=>{let e=[];t.attributes&&t.attributes.length&&t.attributes.forEach((t=>{e.push(`${t.id}-${t.value.id}`)})),t.variant_attributes_id=e})),t):null}}(window);const product_detail_el=new ProductDetail;product_detail_el.initPage();
