"use strict";const API_URL={PRODUCT_DETAIL:"http://dev.omipage.com/api/v1/products/"},EnumLandingBlockElementName={LANDING_PRODUCT_DETAIL:"OMP_PRODUCT_DETAIL"},EnumElementAttributeName={DATA_OMP_ELEMENT:"data-omp-element",DATA_ACTION:"data-action",DATA_SKU:"data-sku",DATA_QUANTITY:"data-quantity",DATA_NAME:"data-name",DATA_PRICE:"data-price",DATA_DISCOUNTED_PRICE:"data-discounted-price",DATA_IMAGE:"data-image",DATA_BUY_NOW:"data-buy-now"},EnumPDElementAttributeValue={PRODUCT_IMAGE:"product-image",PRODUCT_NAME:"product-name",PRODUCT_LISTED_PRICE:"product-listed-price",PRODUCT_PRICE:"product-price",PRODUCT_SELECT_VARIANT:"variant-select",PRODUCT_QUANTITY:"select-quantity",PRODUCT_DESCRIPTION:"product-description",PRODUCT_GROUP_BUTTON_ACTION:"group-button-action",PRODUCT_QUANTITY_INCREASE:"increase-quantity",PRODUCT_QUANTITY_DECREASE:"decrease-quantity",PRODUCT_QUANTITY_VALUE:"quantity-value",ADD_TO_CART:"add_to_cart",CHECKOUT:"checkout"};!function(t){class e{landing_token;constructor(){this._getLandingToken()}_createGetRequest=t=>new Promise(((e,n)=>{const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(4===a.readyState&&200===a.status)return e(a.responseText)},a.open("GET",t,!0),a.setRequestHeader("Authorization",this.landing_token),a.send()}));getProductDetailById=async t=>{const e=`${API_URL.PRODUCT_DETAIL}${t}/`;return await this._createGetRequest(e)};_getLandingToken=()=>{const t=document.querySelectorAll('meta[name="omp-key"]')[0];this.landing_token=`Landing ${t.getAttribute("content")}`}}class n{loading_element=null;constructor(){this.loading_element=document.getElementsByClassName("omp-loading")[0]}_showLoading=()=>{this.loading_element.classList.contains("show")||this.loading_element.classList.add("show")};_hideLoading=()=>{this.loading_element.classList.contains("show")&&this.loading_element.classList.remove("show")};_queryElementsByAttribute=(t,e,n)=>t.querySelectorAll(`div[${e}=${n}]`)[0];_queryElementsByClass=(t,e)=>t.querySelectorAll(`div[class=${e}]`)[0];_queryElementsLikeClassName=(t,e)=>t.querySelectorAll(`div[class^=${e}]`);_productSelectProductBuilder=t=>{if(!t||!t.length)return"";let e="";return t.forEach((t=>{let n="";t.values&&t.values.length&&t.values.forEach((t=>{n+=`<div class="p-variant-item" data-variant-value="${t.id}">\n                                        ${t.name}\n                                    </div>`})),e+=`<div class="omp-container">\n                                           <p class="omp-mb-0">${t.name}</p>\n                                           <div class="product-variant" data-variant="${t.id}">\n                                                ${n}\n                                           </div>\n                                       </div>`})),`<div class="product-detail--select-product">\n                        ${e}\n                    </div>`};_productButtonActionBuilder=(t,e)=>t?`<div class="omp-container display-flex omp-mb-3">\n                        <p class="omp-mb-0">Chọn số lượng</p>\n                        <div class="p-quantity">\n                            <div class="p-quantity-button" data-omp-element="${EnumPDElementAttributeValue.PRODUCT_QUANTITY_DECREASE}">-</div>\n                            <div class="p-quantity-button p-quantity-number" data-omp-element="${EnumPDElementAttributeValue.PRODUCT_QUANTITY_DECREASE}">1</div>\n                            <div class="p-quantity-button" data-omp-element="${EnumPDElementAttributeValue.PRODUCT_QUANTITY_INCREASE}">+</div>\n                        </div>\n                    </div>\n\n                    <div class="omp-container display-flex omp-mb-2">\n                        <button class="btn btn-primary"\n                            data-action="add_to_cart"\n                            data-sku="${t.sku}"\n                            data-quantity="${e}"\n                            data-name="${t.name}"\n                            data-price="${t.listed_price}"\n                            data-discounted-price="${t.price}"\n                            data-image="${t.images[0]}">\n                            Thêm vào giỏ hàng\n                        </button>\n                        <button class="btn btn-danger"\n                            data-action="checkout"\n                            data-sku="${t.sku}"\n                            data-quantity="${e}"\n                            data-name="${t.name}"\n                            data-price="${t.listed_price}"\n                            data-discounted-price="${t.price}"\n                            data-image="${t.images[0]}"\n                            data-buy-now="true">\n                            Mua ngay\n                        </button>\n                    </div>`:"";_updateGroupButtonAttribute=t=>{if(!t)return;const e=e=>{e.setAttribute(EnumElementAttributeName.DATA_SKU,t.sku),e.setAttribute(EnumElementAttributeName.DATA_QUANTITY,t.quantity),e.setAttribute(EnumElementAttributeName.DATA_NAME,t.name),e.setAttribute(EnumElementAttributeName.DATA_PRICE,t.listed_price),e.setAttribute(EnumElementAttributeName.DATA_DISCOUNTED_PRICE,t.price),e.setAttribute(EnumElementAttributeName.DATA_IMAGE,t.images[0])};e(this._queryElementsByAttribute(document,EnumElementAttributeName.DATA_ACTION,EnumPDElementAttributeValue.ADD_TO_CART));e(this._queryElementsByAttribute(document,EnumElementAttributeName.DATA_ACTION,EnumPDElementAttributeValue.CHECKOUT))}}class a{element_content_builder;group_quantity_button;product_detail=null;store_group_selected_id=[];store_variant_group=[];constructor(t,e,n){const a=this;a.product_detail=t,a.element_content_builder=e,a.group_quantity_button=n}_queryProductVariantGroupElements=()=>this.element_content_builder._queryElementsByClass(document,"product-variant");_queryProductVariantOptionElements=t=>this.element_content_builder._queryElementsLikeClassName(t,"p-variant-item");_verifyIncludesArr=(t,e)=>!!(t&&t.length&&e&&e.length)&&e.reduce(((e,n)=>e&&t.includes(n)),!0);_findSelectedVariant=()=>{let t=null;const e=this.store_variant_group.reduce(((t,e)=>t.push(`${e.variant_group_id}-${e.variant_value_selected}`)),[]);return this.product_detail.variants.forEach((n=>{n.variant_attributes_id&&this._verifyIncludesArr(n.variant_attributes_id,e)&&(t=n)})),t};_findVariantOutOfStock=(t,e)=>{const n=[],a=[];return t.forEach((t=>a.push(`${t.variant_group_id}-${t.variant_value_selected}`))),this.product_detail.variants.forEach((t=>{if(t.fulfillable)return;let i=!1;t.variant_attributes_id&&(i=this._verifyIncludesArr(t.variant_attributes_id,a)),i&&n.push(t.attributes.find((t=>t.id===e.variant_group_id))?.value?.id)})),n};_addDisabledClassForVariantOption=(t,e)=>{const n=this._findVariantOutOfStock(t,e);if(!n.length)return;const a=this._queryProductVariantOptionElements(e.group_element);this.store_variant_group.forEach((t=>{t.variant_group_id===e.variant_group_id&&(t.has_child_disabled=!0)}));Array.from(a).filter((t=>n.includes(parseInt(t.getAttribute("data-variant-value"))))).forEach((t=>t.classList.add("disabled")))};_updateProductInfoFollowVariantSelected=t=>{if(!t)return;this.element_content_builder._queryElementsByAttribute(document,EnumElementAttributeName.DATA_OMP_ELEMENT,EnumPDElementAttributeValue.PRODUCT_IMAGE).innerHTML=`<img src="${t.images[0]}" alt="ProductImage">`;this.element_content_builder._queryElementsByAttribute(document,EnumElementAttributeName.DATA_OMP_ELEMENT,EnumPDElementAttributeValue.PRODUCT_NAME).innerHTML=`${t.full_name}`;this.element_content_builder._queryElementsByAttribute(document,EnumElementAttributeName.DATA_OMP_ELEMENT,EnumPDElementAttributeValue.PRODUCT_PRICE).innerHTML=`${t.price}`;this.element_content_builder._queryElementsByAttribute(document,EnumElementAttributeName.DATA_OMP_ELEMENT,EnumPDElementAttributeValue.PRODUCT_LISTED_PRICE).innerHTML=`${t.listed_price}`;this.element_content_builder._queryElementsByAttribute(document,EnumElementAttributeName.DATA_OMP_ELEMENT,EnumPDElementAttributeValue.PRODUCT_DESCRIPTION).innerHTML=`${t.description}`,this.group_quantity_button._updateGroupButtonAttribute(t)};_updateDisableSelectStatus=()=>{let t,e=[];this.store_variant_group.forEach((n=>{null!==n.variant_value_selected?e.push(n):t=n})),e.length===this.store_variant_group.length-1&&this._addDisabledClassForVariantOption(e,t),e.length===this.store_variant_group.length&&(this.store_variant_group.forEach((t=>{e=this.store_variant_group.filter((e=>e.variant_group_id!==t.variant_group_id)),this._addDisabledClassForVariantOption(e,t)})),this._updateProductInfoFollowVariantSelected(this._findSelectedVariant()))};_removeElementClass=(t,e)=>{t&&t.length&&t.forEach((t=>{t.classList.contains(e)&&t.classList.remove(e)}))};_updateVariantSelectedValue=(t,e)=>{if(this.store_variant_group.forEach((n=>{n.variant_group_id===t&&(n.variant_value_selected=e)})),e&&!this.store_group_selected_id.includes(t)&&this.store_group_selected_id.push(t),e||(this.store_group_selected_id=this.store_group_selected_id.filter((e=>e!==t))),this.store_group_selected_id.length>=this.store_variant_group.length-1){const t=this.store_variant_group.find((t=>null===t.variant_value_selected))?.group_element,e=this.store_variant_group.filter((t=>!0===t.has_child_disabled));e.length?e.forEach((t=>{this._removeElementClass(Array.from(this._queryProductVariantOptionElements(t.group_element)),"disabled")})):this._removeElementClass(Array.from(this._queryProductVariantOptionElements(t)),"disabled")}};_addSelectVariantEvent=(t,e)=>{const n=this._queryProductVariantOptionElements(t),a=t=>{if(!t||!t.target)return;const a=t.target;if(a.classList.contains("disabled"))return;let i=null;a.classList.contains("active")?a.classList.remove("active"):(i=parseInt(t.target.getAttribute("data-variant-value")),this._removeElementClass(Array.from(n),"active"),a.classList.add("active")),this._updateVariantSelectedValue(e,i),this._updateDisableSelectStatus()};n.forEach((t=>{t.addEventListener("click",a)}))};handleSelectEvent=()=>{this._queryProductVariantGroupElements().forEach((t=>{const e=parseInt(t.getAttribute("data-variant"));this._addSelectVariantEvent(t,e),this.store_variant_group.push({group_element:t,variant_group_id:e,variant_value_selected:null,has_child_disabled:!1})}))}}class i{element_content_builder;constructor(t){this.element_content_builder=t}_addIncreaseProductQuantityEvent=t=>{const e=this.element_content_builder._queryElementsByAttribute(document,EnumElementAttributeName.DATA_OMP_ELEMENT,EnumPDElementAttributeValue.PRODUCT_QUANTITY_INCREASE),n=this.element_content_builder._queryElementsByAttribute(document,EnumElementAttributeName.DATA_OMP_ELEMENT,EnumPDElementAttributeValue.PRODUCT_QUANTITY_VALUE);e.addEventListener("click",(()=>{const e=parseInt(n.innerHTML);e>=t||(n.innerHTML=e+1)}))};_addDecreaseProductQuantityEvent=()=>{const t=this.element_content_builder._queryElementsByAttribute(document,EnumElementAttributeName.DATA_OMP_ELEMENT,EnumPDElementAttributeValue.PRODUCT_QUANTITY_DECREASE),e=this.element_content_builder._queryElementsByAttribute(document,EnumElementAttributeName.DATA_OMP_ELEMENT,EnumPDElementAttributeValue.PRODUCT_QUANTITY_VALUE);t.addEventListener("click",(()=>{const t=parseInt(e.innerHTML);t<1||(e.innerHTML=t-1)}))};addGroupProductQuantityEvent=t=>{this._addIncreaseProductQuantityEvent(t),this._addDecreaseProductQuantityEvent()}}t.ProductDetail=class{data_service=new e;content_builder=new n;select_variant_button=null;group_quantity_button=null;constructor(){}initPage=()=>{const e=t.location.href.split("."),n=e[e.length-1];this._getProductDetailById(n).then()};_getProductDetailById=async t=>{const e=await this.data_service.getProductDetailById(t),n=this._addVariantAttributesId(JSON.parse(e)),r=this.content_builder._queryElementsByAttribute(document,EnumElementAttributeName.DATA_OMP_ELEMENT,EnumPDElementAttributeValue.PRODUCT_SELECT_VARIANT);n.options&&n.options.length&&(r.innerHTML=this.content_builder._productSelectProductBuilder(n.options)),r.innerHTML+=this.content_builder._productButtonActionBuilder(n,1),this.group_quantity_button=new i(this.content_builder),this.select_variant_button=new a(n,this.content_builder,this.group_quantity_button),this.select_variant_button.handleSelectEvent()};_addVariantAttributesId=t=>t&&t.variants&&t.variants.length?(t.variants.forEach((t=>{let e=[];t.attributes&&t.attributes.length&&t.attributes.forEach((t=>{e.push(`${t.id}-${t.value.id}`)})),t.variant_attributes_id=e})),t):null}}(window);const product_detail_el=new ProductDetail;product_detail_el.initPage();
